"use strict";var app=angular.module("APP_NAME",["ui.router","ui.bootstrap"]);app.constant("tokenStorageKey","my-token"),app.config(function(t,e){t.state("home",{url:"/",templateUrl:"/html/general/home.html",controller:"homeCtrl"}).state("upload",{url:"/upload",templateUrl:"/html/photos/upload.html",controller:"uploadCtrl"}).state("photos",{url:"/photos",templateUrl:"/html/photos/photos.html",controller:"photoCtrl"}).state("users",{"abstract":!0,templateUrl:"/html/users/users.html"}).state("users.login",{url:"/login",templateUrl:"/html/users/form.html",controller:"usersCtrl"}).state("users.register",{url:"/register",templateUrl:"/html/users/form.html",controller:"usersCtrl"}),e.otherwise("/")});var app=angular.module("APP_NAME");app.controller("homeCtrl",function(t){});var app=angular.module("APP_NAME");app.controller("navCtrl",function(t,e,o){t.logout=function(){o.logout(),e.go("home")}});var app=angular.module("APP_NAME");app.controller("photoCtrl",function(t,e){e.get("/files").then(function(e){t.photos=e.data})});var app=angular.module("APP_NAME");app.controller("uploadCtrl",function(t,e){t.uploadFile=function(t){console.log("files:",t);var o=new FormData;o.append("file",t[0]),e.post("/files",o,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(t){console.log(t)}).error(function(t){console.log(t)})}});var app=angular.module("APP_NAME");app.controller("usersCtrl",function(t,e,o,r){t.currentState=o.current.name.split(".")[1].toUpperCase(),t.submit=function(n){var l="LOGIN"===t.currentState?r.login:r.register;l(n).success(function(t){o.go("home")}).error(function(o){t.user={},e.alert(o.message)})}});var app=angular.module("APP_NAME");app.factory("auth",function(t,e,o){var r={};return r.saveToken=function(e){t.localStorage[o]=e},r.getToken=function(){return t.localStorage[o]},r.isLoggedIn=function(){var e=r.getToken();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}return!1},r.currentUser=function(){if(r.isLoggedIn()){var e=r.getToken(),o=JSON.parse(t.atob(e.split(".")[1]));return o.username}},r.register=function(t){return e.post("/users/register",t).success(function(t){r.saveToken(t.token)})},r.login=function(t){return e.post("/users/login",t).success(function(t){r.saveToken(t.token)})},r.logout=function(){t.localStorage.removeItem(o)},r});